<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title th:text="'Components / Accordion - ' + ${pageTitle}">Components / Accordion - NiceAdmin Bootstrap Template</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link th:href="@{/assets/img/favicon.png}" rel="icon">
  <link th:href="@{/assets/img/apple-touch-icon.png}" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
        rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link th:href="@{/assets/vendor/bootstrap/css/bootstrap.min.css}" rel="stylesheet">
  <link th:href="@{/assets/vendor/bootstrap-icons/bootstrap-icons.css}" rel="stylesheet">
  <link th:href="@{/assets/vendor/boxicons/css/boxicons.min.css}" rel="stylesheet">
  <link th:href="@{/assets/vendor/quill/quill.snow.css}" rel="stylesheet">
  <link th:href="@{/assets/vendor/quill/quill.bubble.css}" rel="stylesheet">
  <link th:href="@{/assets/vendor/remixicon/remixicon.css}" rel="stylesheet">
  <link th:href="@{/assets/vendor/simple-datatables/style.css}" rel="stylesheet">


  <!-- Template Main CSS File -->
  <link th:href="@{/assets/css/style.css}" rel="stylesheet">
  <link th:href="@{/assets/css/hr.css}" rel="stylesheet">
  <style>
    /* Custom CSS to make all table rows white */
    table tbody tr {
      background-color: white !important;
    }
     .member-level-chart{
       width: 400px;
       height: 400px;
     }
    .chart-wrap{
      display: flex;
      height: 400px;
    }
    canvas{
      display: block;
      width: 400px;
      height: 100%;
    }
  </style>
  <!-- =======================================================
  * Template Name: NiceAdmin
  * Template URL: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/
  * Updated: Apr 20 2024 with Bootstrap v5.3.3
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->

  <!-- JQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
  <!--chart-->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<!-- ======= Header ======= -->
<header id="header" class="header fixed-top d-flex align-items-center header-hr">

  <div class="d-flex align-items-center justify-content-between header-hr-left">
    <a href="#" class="logo d-flex align-items-center">
      <img th:src="@{/assets/img/logo/logo-vertical.png}" alt="" style="width: 50px; margin-top: 20px;">
      <span class="d-none d-lg-block">EngleBee</span>
    </a>
  </div><!-- End Logo -->
  <div class="header-hr-right">
    <a href="#" style="margin-right: 20px">로그인</a>
    <a href="#">회원가입</a>
  </div>
</header><!-- End Header -->

<main id="main_wrap" class="main">
  <div id="main" style="margin:auto; margin-top:80px">
    <div class="pagetitle">
      <h1>DashBoard</h1>
    </div><!-- End Page Title -->
    <div class="card">
      <div class="card-header card-header-hr">
        <h5>태그별 멤버 분표</h5>
      </div>
      <div class="card-body card-body-hr">
        <div class = "chart-wrap">
          <canvas id="grammer-count" class="member-level-chart"></canvas>
          <canvas id="sentence-count" class="member-level-chart"></canvas>
          <canvas id="word-count" class="member-level-chart"></canvas>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-header card-header-hr">
        <h5>일일 수업 개설 횟수</h5>
      </div>
      <div class="card-body card-body-hr">
        일일 수업 개설 횟수를 볼 수 있습니다
      </div>
    </div>
    <div class="card">
      <div class="card-header card-header-hr">
        <h5>나이대별 학생 분포</h5>
      </div>
      <div class="card-body card-body-hr">
        나이대별 학생 분포 수를 볼 수 있습니다
      </div>
    </div>
    <div class="card">
      <div class="card-header card-header-hr">
        <h5>LLM API 호출 수</h5>
      </div>
      <div class="card-body card-body-hr">
        날짜별 LLM API 호출 수 통계를 볼 수 있습니다.
      </div>
    </div>
  </div>
</main><!-- End #main -->

<!-- ======= Footer ======= -->
<footer id="footer" class="footer" style="margin-left: 0">
  <div class="copyright">
    &copy; Copyright <strong><span>NiceAdmin</span></strong>. All Rights Reserved
  </div>
  <div class="credits">
    <!-- All the links in the footer should remain intact. -->
    <!-- You can delete the links only if you purchased the pro version. -—>
    <!— Licensing information: https://bootstrapmade.com/license/ —>
    <!— Purchase the pro version with-->
  </div>
</footer>
<script>
  $(function(){

    function fetchData() {
      $.ajax({
        url: '/api/admin/userlevel',
        method: 'GET',
        contentType: "application/json",
        success: function (data) {

          const grammarList = data.grammarList;
          const sentenceList = data.sentenceList;
          const wordList = data.wordList;
          console.log("성공" + grammarList);

          grammarList.forEach(function (item) {
            console.log(item.levelCode + ": " + item.count);
          });

          // levelCode와 count를 별도의 배열로 분리
          const grammerLabels = grammarList.map(item => item.levelCode);  // 레벨 코드들
          const grammerCounts = grammarList.map(item => item.count);  // 각 레벨에 해당하는 카운트

          const sentenceLabels = sentenceList.map(item => item.levelCode);
          const sentenceCounts = sentenceList.map(item => item.count);

          const wordLabels = wordList.map(item => item.levelCode);
          const wordCounts = wordList.map(item => item.count);

          const ctx = document.getElementById('grammer-count').getContext('2d');
          const grammerCanvas = document.getElementById('grammer-count');
          grammerCanvas.style.width = '400px';
          grammerCanvas.style.height = '100%';
          const grammerchart = new Chart(ctx, {
            type: 'pie',
            data: {
              labels: grammerLabels,  // 차트의 레이블 (레벨 코드)
              datasets: [{
                label: 'Grammar Levels',
                data: grammerCounts,  // 각 레벨의 카운트
                backgroundColor: [
                  'rgba(255, 99, 132, 0.2)',
                  'rgba(54, 162, 235, 0.2)',
                  'rgba(255, 206, 86, 0.2)',
                  'rgba(75, 192, 192, 0.2)',
                  'rgba(153, 102, 255, 0.2)',
                  'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                  'rgba(255, 99, 132, 1)',
                  'rgba(54, 162, 235, 1)',
                  'rgba(255, 206, 86, 1)',
                  'rgba(75, 192, 192, 1)',
                  'rgba(153, 102, 255, 1)',
                  'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  position: 'top',
                },
                title: {
                  display: true,
                  text: 'Grammar Levels Distribution'
                }
              }
            },
          });

          const sentenceCtx = document.getElementById('sentence-count').getContext('2d');
          const sentenceChart = new Chart(sentenceCtx, {
            type: 'pie',
            data: {
              labels: sentenceLabels,  // 차트의 레이블 (레벨 코드)
              datasets: [{
                label: 'Sentence Levels',
                data: sentenceCounts,  // 각 레벨의 카운트
                backgroundColor: [
                  'rgba(255, 99, 132, 0.2)',
                  'rgba(54, 162, 235, 0.2)',
                  'rgba(255, 206, 86, 0.2)',
                  'rgba(75, 192, 192, 0.2)',
                  'rgba(153, 102, 255, 0.2)',
                  'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                  'rgba(255, 99, 132, 1)',
                  'rgba(54, 162, 235, 1)',
                  'rgba(255, 206, 86, 1)',
                  'rgba(75, 192, 192, 1)',
                  'rgba(153, 102, 255, 1)',
                  'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  position: 'top',
                },
                title: {
                  display: true,
                  text: 'Sentence Levels Distribution'
                }
              }
            },
          });

                const wordCtx = document.getElementById('word-count').getContext('2d');
                const wordChart = new Chart(wordCtx, {
                  type: 'pie',
                  data: {
                    labels: wordLabels,  // 차트의 레이블 (레벨 코드)
                    datasets: [{
                      label: 'Sentence Levels',
                      data: wordCounts,  // 각 레벨의 카운트
                      backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                      ],
                      borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                      ],
                      borderWidth: 1
                    }]
                  },
                  options: {
                    responsive: true,
                    plugins: {
                      legend: {
                        position: 'top',
                      },
                      title: {
                        display: true,
                        text: 'Word Levels Distribution'
                      }
                    }
                  },
                });

              },

              error: function () {
                console.error('[ERROR] 데이터를 불러오던 도중 에러가 발생했습니다');
              }
            });
        }

    fetchData();
  })
</script>
</body>
</html>
